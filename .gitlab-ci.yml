variables:
  DEPENDENCIES: redhat-rpm-config meson git gettext gtk-doc meson glib2-devel libxml2-devel gobject-introspection-devel libgcrypt-devel libarchive-devel
  DEPS_QUVI: libquvi-devel
  TEST_DEPS: gvfs dbus-daemon

build-fedora:
  image: fedora:latest
  before_script:
    # Update
    - dnf -y update && dnf install -y $DEPENDENCIES
  script:
    - meson _build
    - dnf install -y $TEST_DEPS
    - GIO_USE_VOLUME_MONITOR=unix dbus-run-session ninja -C _build test
    - ninja -C _build install
    # And now with quvi support
    - rm -rf _build
    - dnf install -y $DEPS_QUVI
    - meson _build
    - GIO_USE_VOLUME_MONITOR=unix dbus-run-session ninja -C _build test
    - ninja -C _build install
